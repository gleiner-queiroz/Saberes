<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Saberes - Conte√∫dos</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="top-bar">
    <div>
      <strong>Saberes</strong> ‚Äî √Årea do Professor
    </div>
    <div style="display:flex; gap:12px;">
      <div class="badge-circle" onclick="abrirChats()" title="Chats">
        üí¨
      </div>
      <div class="badge-circle" onclick="abrirPerfil()" title="Perfil">
        üë§
      </div>
    </div>
  </div>

  <div class="main-layout">
    <div class="card-list">
      <h3>Filtros</h3>
      <div class="input-group">
        <label for="filtro-busca">Buscar por t√≠tulo</label>
        <input id="filtro-busca" oninput="carregarConteudos()" />
      </div>
      <div class="input-group">
        <label for="filtro-serie">S√©rie</label>
        <select id="filtro-serie" onchange="carregarConteudos()">
          <option value="">Todas</option>
          <option value="1¬∞ ano">1¬∞ ano</option>
          <option value="2¬∞ ano">2¬∞ ano</option>
          <option value="3¬∞ ano">3¬∞ ano</option>
        </select>
      </div>
    </div>

    <div class="card-list">
      <h3>Meus conte√∫dos</h3>
      <div id="lista-conteudos"></div>
    </div>
  </div>

  <button class="fab" onclick="novoConteudo()">+</button>

  <script>
    const API = "http://localhost/saberes/api";
    let professor = null;

    window.onload = () => {
      const profStr = localStorage.getItem("professor");
      if (!profStr) {
        window.location = "login.html";
        return;
      }
      professor = JSON.parse(profStr);
      carregarConteudos();
    };

    async function carregarConteudos() {
      const busca = document.getElementById("filtro-busca").value;
      const serie = document.getElementById("filtro-serie").value;
      const lista = document.getElementById("lista-conteudos");
      lista.innerHTML = "Carregando...";

      try {
        const resp = await fetch(`${API}/listar_conteudos.php?busca=${encodeURIComponent(busca)}&serie=${encodeURIComponent(serie)}`);
        const data = await resp.json();
        lista.innerHTML = "";

        data.forEach(c => {
          const div = document.createElement("div");
          div.className = "content-card";
          div.onclick = () => abrirConteudo(c.id);

          div.innerHTML = `
            <div>
              <div style="font-weight:600;">${c.titulo}</div>
              <div style="font-size:12px; color:#aaa;">${c.materia} ‚Ä¢ ${c.serie}</div>
            </div>
            <div style="font-size:11px; color:#777;">
              ${new Date(c.criado_em).toLocaleDateString("pt-BR")}
            </div>
          `;
          lista.appendChild(div);
        });

        if (data.length === 0) {
          lista.innerHTML = "<p>Nenhum conte√∫do encontrado.</p>";
        }
      } catch (e) {
        lista.innerHTML = "<p>Erro ao carregar conte√∫dos.</p>";
      }
    }

    function novoConteudo() {
      window.location = "conteudo_form.html";
    }

    function abrirConteudo(id) {
      window.location = `conteudo_form.html?id=${id}`;
    }

    function abrirPerfil(){
      alert("Aqui voc√™ far√° a tela de perfil do professor.");
    }

    function abrirChats(){
      window.location = "chats.html";
    }
  </script>
</body>
</html>
